<!DOCTYPE html>
<html>
<head>
    <title>Bus Dashboard</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #222; color: #fff; padding: 40px; }
        .bus-row { display: flex; justify-content: space-between; font-size: 3rem; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .line-number { font-weight: bold; color: #E56E00; /* TPG Orange-ish */ width: 15%; }
        .destination { width: 55%; }
        .time { font-size: 6rem; font-weight: bold; width: 30%; text-align: right; }
        .status { font-size: 1rem; color: #888; text-align: right; }
    </style>
</head>
<body>
    <h1>Next Buses</h1>
    <div id="bus-container">Loading...</div>

    <script>
        // CONFIGURATION
const STOP_NAME = "Geneve,Cirque"; // Replace with your actual stop name

async function fetchBuses() {
    const now = new Date();
    const hour = now.getHours();
    
    // Determine if it's Morning (before 12:00) or Afternoon
    const isMorning = hour < 12;
    
    // Define the filters based on your rules
    const targetLines = ["2", "19"];
    const targetDestinations = isMorning 
        ? ["Bernex, Cressy", "Onex, cité"] 
        : ["Genève, Plage", "Vernier, village"];

    try {
        // Fetch more results (limit=20) to ensure we find our specific lines
        const response = await fetch(`https://transport.opendata.ch/v1/stationboard?station=${STOP_NAME}&limit=20`);
        const data = await response.json();
        
        const container = document.getElementById('bus-container');
        container.innerHTML = `<h2>${isMorning ? 'Morning Commute' : 'Afternoon Returns'}</h2>`;

        // Filter the results
        const filteredBuses = data.stationboard.filter(bus => {
            const matchesLine = targetLines.includes(bus.number);
            const matchesDest = targetDestinations.some(d => bus.to.includes(d));
            return matchesLine && matchesDest;
        });

        if (filteredBuses.length === 0) {
            container.innerHTML += "<p>No matching buses found in the next hour.</p>";
            return;
        }

        // Display the filtered results
        filteredBuses.slice(0, 4).forEach(bus => {
            const departureStr = bus.stop.prognosis.departure || bus.stop.departure;
            const departureTime = new Date(departureStr);
            const diffMins = Math.floor((departureTime - now) / 60000);

            if (diffMins < 0) return;

            const div = document.createElement('div');
            div.className = 'bus-row';
            div.innerHTML = `
                <span class="line-number" style="color: ${bus.number === '2' ? '#E56E00' : '#0078D7'}">
                    ${bus.number}
                </span>
                <span class="destination">${bus.to}</span>
                <span class="time">${diffMins} min</span>
            `;
            container.appendChild(div);
        });
    } catch (error) {
        console.error("Error fetching data:", error);
    }
}
    </script>
</body>
</html>
