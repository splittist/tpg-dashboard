<!DOCTYPE html>
<html>
<head>
    <title>Bus Dashboard</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #222; color: #fff; padding: 40px; }
        .bus-row { display: flex; justify-content: space-between; font-size: 3rem; margin-bottom: 20px; border-bottom: 1px solid #444; padding-bottom: 10px; }
        .line-number { font-weight: bold; color: #E56E00; /* TPG Orange-ish */ width: 15%; }
        .destination { width: 55%; }
        .time { font-weight: bold; width: 30%; text-align: right; }
        .status { font-size: 1rem; color: #888; text-align: right; }
    </style>
</head>
<body>
    <h1>Next Buses</h1>
    <div id="bus-container">Loading...</div>

    <script>
        // CONFIGURATION
        const STOP_NAME = "Geneve,Cirque"; // REPLACE WITH YOUR STOP
        const REFRESH_SECONDS = 60;

        async function fetchBuses() {
            const response = await fetch(`https://transport.opendata.ch/v1/stationboard?station=${STOP_NAME}&limit=6`);
            const data = await response.json();
            
            const container = document.getElementById('bus-container');
            container.innerHTML = ''; // Clear old data

            data.stationboard.forEach(bus => {
                // Get time: Prioritize real-time prognosis, fallback to scheduled
                const departureStr = bus.stop.prognosis.departure || bus.stop.departure;
                const departureTime = new Date(departureStr);
                const now = new Date();
                
                // Calculate minutes until bus
                const diffMs = departureTime - now;
                const diffMins = Math.floor(diffMs / 60000);

                if (diffMins < 0) return; // Skip buses that already left

                // Create HTML elements
                const div = document.createElement('div');
                div.className = 'bus-row';
                div.innerHTML = `
                    <span class="line-number">${bus.number}</span>
                    <span class="destination">${bus.to}</span>
                    <span class="time">${diffMins} min</span>
                `;
                container.appendChild(div);
            });
        }

        fetchBuses();
        setInterval(fetchBuses, REFRESH_SECONDS * 1000);
    </script>
</body>
</html>
